## 1. Общее описание базовых характеристик платформы

### Назначение
Платформа для автоматизации торговли на криптовалютных биржах через ботов.

### Этапы:
1. Реализация **сеточного бот**, для личного использования с распространением уникальных доступов среди доверенных лиц. (этап обкатки и доработок. Поддержка только для ByBit)
2. Внедрение системы регистрации широкого использования бота в формате платного доступа и добавление поддержки других бирж
3. Запуск службы поддержки и официальных каналов (тг, дзен, вк и т.п.)
4. Модернизация платформы и внедрение дополнительных сервисов (скринеры, графики, бэктестирование, инвестиционные пулы)
5. Внедрение MCP сервера и реализация специальных сервисов на основе AI (изучение данных о сделках, выявление тенденций и закономерностей, обработка данных с целью построения разного рода статистики, применение искусственного интелекта в бэктестировании)
6. Внедрение реферальной системы для привлечения партнеров и расширения потребительского рынка

### Целевая аудитория
- Трейдеры с опытом.
- Трейдеры без опыта.
- Мелкие и средние инвесторы, желающие размещать часть капитала в алгоритмической торговле криптой.
- Люди вне трейдинга, ищущие источники дополнительного заработка.

### Основные функции платформы
- Регистрация / авторизация пользователей.
- Привязка API-ключей от бирж.
- Создание и запуск ботов.
- Отслеживание активности ботов.
- Статистика доходности, история сделок.
- Управление рисками и параметрами торговли.

### Технологический стек
- **Backend**: FastAPI, PostgreSQL, Alembic, SQLAlchemy
- **Frontend**: Nuxt.js (полная поддержка мобильных устройств)
- **Биржи**: первый этап ByBit (последующие: Binance, Мexc, KuCoin, OKX и др.)
- **Дополнительно**: Redis (кеширование), Celery (асинхронные задачи), RabbitMQ/Kafka (очереди сообщений и логирование)

---

## 2. Внутреннее устройство функционала и основные пользовательские сценарии

### Основные модули
#### a) Пользовательский интерфейс (UI)
- Личный кабинет
- Дашборд с активными ботами
- Страница настройки и запуска бота
- История сделок
- Статистика торговли
- Управление привязанными биржами

#### b) Биржевой модуль
- Класс для работы с API бирж (на первом этапе поддержка только ByBit)
- Реализация методов:
  - Получение рыночных данных (цены, глубина книги)
  - Работа с ордерами и позициями
  - Получение информации по сделкам
  - Получение данных из аккаунта (баланс, доступные средства, плечо и т.д)

#### c) Модуль бота
- Реализация логики бота
  - Настройки основных параметров
  - Стратегия (например, только лонг или только шорт)
  - Перезапуск при падении
  - Автоматическое закрытие при достижении целевых показателей
  - Экстренная остановка бота при необходимости

#### d) Модуль мониторинга
- Логирование действий бота
- Метрики: P/F, P/L, количество сделок

#### e) Модуль безопасности
- Хранение API-ключей в зашифрованном виде
- Проверка прав доступа черех аутентификацию/авторизацию (настройка access_token и refresh_token через кукки)
- Rate-limiting и защита от DDoS (в последующих этапах)

---

### Основные пользовательские сценарии

#### Сценарий 1: Регистрация и подключение биржи
1. Пользователь регистрируется на платформе
2. Переходит в раздел "Профиль"
3. Подтверждает свой аккаунт через телефона или email
4. Получает возможность добавлять API-ключи от биржи
4. Платформа проверяет корректность ключей и если все ок, кодирует их и сохраняет в базе

#### Сценарий 2: Создание и запуск бота
1. Пользователь выбирает пару
2. Задает параметры в соответствии с логикой торговли бота
3. Платформа рассчитывает ожидаемую прибыль и соответствие размера депозита заданным параметрам
4. Если депозит не соответствует заданным параметрами, предупреждает о возможных рисках потери депозита
5. После подтверждения бот запускается
6. Начинает выставлять ордера на бирже и выводить их в соответствующем разделе на сайте

#### Сценарий 3: Мониторинг активности
1. Пользователь открывает дашборд
2. Видит список активных ботов и список последних актиных позиций
3. Пользователь имеет прямой доступ к кнопке «Оставить Бота»
4. Может нажать на бота и увидеть:
   - Все активные ордера
   - Последние сделки
   - Отмененные ордера
   - Текуший профит/убыток
5. При необходимости останавливает бота, или запускает, если бот был остановлен

---

## 3. Дизайн базы данных

### (пока в упрощенном варианте)

- Список основных сущностей и их структура данных

```
Users
───────
id (PK)
email
password_hash
created_at

Profiles
──────────
id (PK)
api_key (encrypted)
api_secret (encrypted)
user_id (FK to Users.id)

Exchanges
──────────
id (PK)
name (ByBit, binance, и т.д)

Bots
────
id (PK)
type (grid, ...)
status (active, stopped, error)
exchange_id (FK to Exchanges.id)
symbol (BTCUSDT и т.п.)
config JSON
started_at
stopped_at

Trades
──────
id (PK)
bot_id (FK to Bots.id)
trade_type (buy/sell)
price
amount
timestamp

Orders
──────
id (PK)
bot_id (FK to Bots.id)
order_id_external
price
amount
side
status
created_at
updated_at

Metrics
───────
id (PK)
bot_id (FK to Bots.id)
profit_usdt
roi_percent
total_trades
last_updated
```

### Особенности:
- Использование **JSONB** для гибкой конфигурации ботов
- Все чувствительные данные шифруются перед записью в БД
- Для аналитики можно использовать Materialized Views или внешние BI-инструменты

---

## 4. Архитектура бэкенда

### Модули FastAPI:
- **AuthRouter**: регистрация, логин, восстановление пароля
- **UserRouter**: управление профилем, API-ключами
- **BotRouter**: CRUD операции над ботами
- **TradeRouter**: получение истории сделок
- **DashboardRouter**: метрики и статистика

### Сервисы:
- **AuthService**
- **UserService**
- **ExchangeService**
- **BotService**
- **TradeService**
- **GridBotEngine**

### Асинхронная обработка:
- Через **Celery** + **RabbitMQ**
- Задачи:
  - Периодическая проверка состояния ботов
  - Обновление статусов ордеров
  - Синхронизация с биржей
  - Расчёт метрик

### ORM:
- SQLAlchemy (async)
- Alembic для миграций

---

## 5. Архитектура фронтенда

### Фреймворк: **Nuxt.js (Vue 3)**

#### Основные страницы:
- `/login`, `/register`, `/profile`
- `/dashboard` – главная страница с ботами
- `/bots/create` – форма настройки нового бота
- `/bots/[id]` – детали конкретного бота
- `/trades` – история сделок
- `/settings` – настройки бирж, уведомлений и т.д.

---